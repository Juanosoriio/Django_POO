<!DOCTYPE html>
<html>
<head>
    <title>Lista de Pedidos</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        h1 { color: #333; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #007bff; color: white; }
        tr:hover { background-color: #f5f5f5; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        p { text-align: center; margin-top: 20px; }
        .action-btn { background-color: #007bff; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; display: inline-block; width: 35px; text-align: center; }
        .action-btn:hover { background-color: #0056b3; }
        .delete-btn { background-color: #dc3545; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; display: inline-block; width: 35px; text-align: center; }
        .delete-btn:hover { background-color: #c82333; }
        .create-btn { background-color: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; display: inline-block; }
        .create-btn:hover { background-color: #218838; text-decoration: none; color: white; }
        .action-btn i, .delete-btn i, .create-btn i { font-size: 16px; }
    </style>
</head>
<body>
    <h1>Lista de Pedidos</h1>
    <p><a href="{% url 'crear_pedido' %}" class="create-btn"><i class="fas fa-plus"></i> Crear Nuevo Pedido</a></p>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Fecha Pedido</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
            <tr>
                <td>{{ pedido.id }}</td>
                <td>{{ pedido.cliente }}</td>
                <td>{{ pedido.fecha_pedido }}</td>
                <td>{{ pedido.producto }}</td>
                <td>{{ pedido.cantidad }}</td>
                <td>{{ pedido.get_estado_display }}</td>
                <td>
                    <a href="{% url 'ver_pedido' pedido.id %}" class="action-btn" title="Ver"><i class="fas fa-eye"></i></a>
                    <a href="{% url 'actualizar_pedido' pedido.id %}" class="action-btn" title="Editar"><i class="fas fa-edit"></i></a>
                    <button class="delete-btn" onclick="confirmDelete({{ pedido.id }}, '{{ pedido.cliente }} - {{ pedido.producto }}')" title="Eliminar"><i class="fas fa-trash"></i></button>
                    <form id="delete-form-{{ pedido.id }}" method="post" action="{% url 'eliminar_pedido' pedido.id %}" style="display: none;">
                        {% csrf_token %}
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="7">No hay pedidos registrados.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function confirmDelete(id, pedidoInfo) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: `¿Deseas eliminar el pedido: ${pedidoInfo}?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById(`delete-form-${id}`).submit();
                }
            });
        }

        // Mostrar mensajes de éxito con SweetAlert
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'success' %}
                    Swal.fire({
                        icon: 'success',
                        title: 'Éxito',
                        text: '{{ message }}',
                        timer: 3000,
                        showConfirmButton: false
                    });
                {% endif %}
            {% endfor %}
        {% endif %}
    </script>
</body>
</html>
